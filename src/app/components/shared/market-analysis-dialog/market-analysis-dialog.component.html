<div class="market-analysis-container">
  <h2 mat-dialog-title>An√°lise de Mercado: {{data.produto.nome}}</h2>
  
  <mat-dialog-content>
    @if (isLoading) {
      <div class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Analisando dados do mercado...</p>
      </div>
    } @else if (error) {
      <div class="error-container">
        <mat-icon color="warn">error</mat-icon>
        <p>{{error}}</p>
      </div>
    } @else {
      <div class="analysis-content">
        <!-- Produto Original -->
        <mat-card class="product-info">
          <mat-card-header>
            <mat-card-title>Produto Analisado</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p><strong>Nome:</strong> {{marketData?.original.name}}</p>
            <p><strong>Pre√ßo:</strong> R$ {{marketData?.original.price | number:'1.2-2'}}</p>
          </mat-card-content>
        </mat-card>

        <!-- Produtos Similares -->
        @if (marketData?.competitors?.length) {
          <mat-card class="similar-products">
            <mat-card-header>
              <mat-card-title>Produtos Similares</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="products-grid">
                @for (product of marketData.competitors; track product.id) {
                  <div class="product-item">
                    <span class="product-name">{{product.title}}</span>
                    <span class="product-price">R$ {{product.price | number:'1.2-2'}}</span>
                    @if (product.monthlySalesEstimate) {
                      <span class="product-sales">{{product.monthlySalesEstimate}} vendas/m√™s</span>
                    }
                  </div>
                }
              </div>
            </mat-card-content>
          </mat-card>
        }

        <!-- Gr√°fico de Tend√™ncias -->
        @if (priceChartData) {
          <mat-card class="trends-chart">
            <mat-card-header>
              <mat-card-title>Compara√ß√£o de Pre√ßos</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-container">
                <canvas baseChart
                  [data]="priceChartData"
                  [options]="priceChartOptions"
                  [type]="'bar'">
                </canvas>
              </div>
            </mat-card-content>
          </mat-card>
        }

        @if (salesChartData) {
          <mat-card class="trends-chart">
            <mat-card-header>
              <mat-card-title>An√°lise de Vendas</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-container">
                <canvas baseChart
                  [data]="salesChartData"
                  [options]="salesChartOptions"
                  [type]="'line'">
                </canvas>
              </div>
            </mat-card-content>
          </mat-card>
        }

        <!-- Insights -->
        @if (marketData?.insights) {
          <mat-card class="market-insights">
            <mat-card-header>
              <mat-card-title>Insights do Mercado</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="insight-item">
                <h4>üí∞ Posicionamento de Pre√ßo</h4>
                <p>{{marketData.insights.price}}</p>
              </div>
              <div class="insight-item">
                <h4>üìà An√°lise de Vendas</h4>
                <p>{{marketData.insights.popularity}}</p>
              </div>
              <div class="insight-item">
                <h4>üîç Volume de Buscas</h4>
                <p>{{marketData.insights.search}}</p>
              </div>
            </mat-card-content>
          </mat-card>
        }
      </div>
    }
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="dialogRef.close()">Fechar</button>
  </mat-dialog-actions>
</div>
