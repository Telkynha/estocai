<div class="market-analysis-container">
  <h2 mat-dialog-title>Análise de Mercado: {{data.productName}}</h2>
  
  <mat-dialog-content>
    @if (loading) {
      <div class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Analisando dados do mercado...</p>
      </div>
    } @else if (error) {
      <div class="error-container">
        <mat-icon color="warn">error</mat-icon>
        <p>{{error}}</p>
      </div>
    } @else {
      <div class="analysis-content">
        <!-- Produto Original -->
        <mat-card class="product-info">
          <mat-card-header>
            <mat-card-title>Produto Analisado</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p><strong>Nome:</strong> {{analysisData?.original_product.name}}</p>
            <p><strong>Preço:</strong> {{analysisData?.original_product.price}}</p>
          </mat-card-content>
        </mat-card>

        <!-- Produtos Similares -->
        @if (analysisData?.similar_products?.length) {
          <mat-card class="similar-products">
            <mat-card-header>
              <mat-card-title>Produtos Similares</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="products-grid">
                @for (product of analysisData.similar_products; track product.name) {
                  <div class="product-item">
                    <span class="product-name">{{product.name}}</span>
                    <span class="product-price">{{product.price}}</span>
                  </div>
                }
              </div>
            </mat-card-content>
          </mat-card>
        }

        <!-- Gráfico de Tendências -->
        @if (chartData) {
          <mat-card class="trends-chart">
            <mat-card-header>
              <mat-card-title>Tendências de Mercado</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-container">
                <p-chart type="line" [data]="chartData" [options]="chartOptions"></p-chart>
              </div>
            </mat-card-content>
          </mat-card>
        }

        <!-- Insights -->
        @if (analysisData?.market_insights) {
          <mat-card class="market-insights">
            <mat-card-header>
              <mat-card-title>Insights do Mercado</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <p>{{analysisData.market_insights}}</p>
            </mat-card-content>
          </mat-card>
        }
      </div>
    }
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="close()">Fechar</button>
  </mat-dialog-actions>
</div>
